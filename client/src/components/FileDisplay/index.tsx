import { FileType } from '@/api/socket'
import Image from 'next/image'
import Link from 'next/link'
import { useState } from 'react'

const imgFormats = ['jpg', 'png', 'jpeg', 'svg']
function isFileImage(file: File | string) {
  if(typeof file === "string")
  return imgFormats.includes(
    file.slice(((file.lastIndexOf('.') - 1) >>> 0) + 2)
  )
  return file && file.type.split('/')[0] === 'image'
}

function isFileVideo(file: File) {
  return file && file.type.split('/')[0] === 'video'
}

export default function FileDisplay({ file }: { file: FileType }) {
  const src =
    typeof file.buffer === 'string'
      ? file.buffer
      : URL.createObjectURL(file.buffer)
      const [visible, setVisible] = useState(false)
  if (isFileImage(file.buffer)) {
    return (
      <>
        {visible && (
          <div
            onClick={() => setVisible(false)}
            className='bg-black bg-opacity-75 z-10 grid fixed left-0 top-0 h-screen w-screen place-content-center'
          >
            <Image
              onClick={() => setVisible(true)}
              src={src}
              height={400}
              width={400}
              alt='files'
              className='rounded-xl'
            />
          </div>
        )}
        <Image
          onClick={() => setVisible(true)}
          src={src}
          height={80}
          width={80}
          alt='files'
          className='rounded-xl cursor-pointer'
        />
      </>
    )
  }
/*   if (isFileVideo(file.buffer)) {
    return (
      <video
        controls
        src={URL.createObjectURL(file.buffer)}
        height={80}
        width={80}
        className='rounded-xl'
      />
    )
  } */
  return (
    <Link
      href={src}
      target='_blank'
      className='rounded-xl bg-gray-100 dark:bg-[#191919] h-[80px] p-4 block'
    >
      <svg
        width='30'
        height='30'
        viewBox='0 0 30 30'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
      >
        <path
          d='M16.25 3.75L17.1339 2.86611C16.8995 2.6317 16.5815 2.5 16.25 2.5V3.75ZM23.75 11.25H25C25 10.9185 24.8683 10.6005 24.6339 10.3661L23.75 11.25ZM12.5 16.25C12.5 15.5596 11.9404 15 11.25 15C10.5597 15 10 15.5596 10 16.25H12.5ZM10 20C10 20.6904 10.5597 21.25 11.25 21.25C11.9404 21.25 12.5 20.6904 12.5 20H10ZM10.625 11.25C9.93465 11.25 9.375 11.8097 9.375 12.5C9.375 13.1904 9.93465 13.75 10.625 13.75V11.25ZM11.875 13.75C12.5654 13.75 13.125 13.1904 13.125 12.5C13.125 11.8097 12.5654 11.25 11.875 11.25V13.75ZM10.625 7.5C9.93465 7.5 9.375 8.05965 9.375 8.75C9.375 9.44035 9.93465 10 10.625 10V7.5ZM11.875 10C12.5654 10 13.125 9.44035 13.125 8.75C13.125 8.05965 12.5654 7.5 11.875 7.5V10ZM15 3.75V9.25H17.5V3.75H15ZM18.25 12.5H23.75V10H18.25V12.5ZM15 9.25C15 9.57941 14.999 9.90164 15.0211 10.1728C15.0445 10.4585 15.0996 10.7957 15.2725 11.135L17.5 10C17.5366 10.0719 17.5236 10.1004 17.5129 9.96921C17.501 9.82348 17.5 9.62067 17.5 9.25H15ZM18.25 10C17.8794 10 17.6765 9.99903 17.5308 9.98713C17.3996 9.97641 17.4281 9.96338 17.5 10L16.365 12.2275C16.7043 12.4004 17.0415 12.4555 17.3273 12.4788C17.5984 12.501 17.9206 12.5 18.25 12.5V10ZM15.2725 11.135C15.5121 11.6054 15.8946 11.9878 16.365 12.2275L17.5 10L15.2725 11.135ZM10 16.25V20H12.5V16.25H10ZM10.625 13.75H11.875V11.25H10.625V13.75ZM10.625 10H11.875V7.5H10.625V10ZM16.25 2.5H10.25V5H16.25V2.5ZM5 7.75V22.25H7.5V7.75H5ZM10.25 27.5H19.75V25H10.25V27.5ZM25 22.25V11.25H22.5V22.25H25ZM24.6339 10.3661L17.1339 2.86611L15.3661 4.63389L22.8661 12.1339L24.6339 10.3661ZM19.75 27.5C20.4295 27.5 21.0143 27.501 21.4938 27.4618C21.988 27.4214 22.4795 27.3323 22.9525 27.0913L21.8175 24.8638C21.7556 24.8953 21.6298 24.9424 21.2903 24.9701C20.936 24.999 20.4708 25 19.75 25V27.5ZM22.5 22.25C22.5 22.9708 22.499 23.436 22.4701 23.7903C22.4424 24.1298 22.3953 24.2556 22.3638 24.3175L24.5913 25.4525C24.8323 24.9795 24.9214 24.488 24.9618 23.9938C25.001 23.5143 25 22.9295 25 22.25H22.5ZM22.9525 27.0913C23.6581 26.7318 24.2318 26.1581 24.5913 25.4525L22.3638 24.3175C22.2439 24.5528 22.0528 24.7439 21.8175 24.8638L22.9525 27.0913ZM5 22.25C5 22.9295 4.99903 23.5143 5.03821 23.9938C5.07859 24.488 5.16774 24.9795 5.40873 25.4525L7.63624 24.3175C7.60475 24.2556 7.55765 24.1298 7.52991 23.7903C7.50098 23.436 7.5 22.9708 7.5 22.25H5ZM10.25 25C9.52931 25 9.06396 24.999 8.7098 24.9701C8.37021 24.9424 8.24431 24.8953 8.18251 24.8638L7.04754 27.0913C7.52051 27.3323 8.01204 27.4214 8.50621 27.4618C8.9858 27.501 9.57056 27.5 10.25 27.5V25ZM5.40873 25.4525C5.76825 26.1581 6.34193 26.7318 7.04754 27.0913L8.18251 24.8638C7.94731 24.7439 7.75609 24.5528 7.63624 24.3175L5.40873 25.4525ZM10.25 2.5C9.57056 2.5 8.9858 2.49903 8.50621 2.53821C8.01204 2.57859 7.52051 2.66774 7.04754 2.90873L8.18251 5.13624C8.24431 5.10475 8.37021 5.05765 8.7098 5.02991C9.06396 5.00098 9.52931 5 10.25 5V2.5ZM7.5 7.75C7.5 7.02931 7.50098 6.56396 7.52991 6.2098C7.55765 5.87021 7.60475 5.74431 7.63624 5.68251L5.40873 4.54754C5.16774 5.02051 5.07859 5.51204 5.03821 6.00621C4.99903 6.4858 5 7.07056 5 7.75H7.5ZM7.04754 2.90873C6.34193 3.26825 5.76825 3.84193 5.40873 4.54754L7.63624 5.68251C7.75609 5.44731 7.94731 5.25609 8.18251 5.13624L7.04754 2.90873Z'
          className='fill-primaryBlack dark:fill-white'
        />
      </svg>

      <span>{file.name}</span>
    </Link>
  )
}
